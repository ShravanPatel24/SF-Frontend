import{k as S,j as a,r as c,i as L,B as I}from"./index-50ad91ff.js";import{P as $}from"./PageBreadcrumb-2adbd738.js";import{S as U}from"./Spinner-57400a8f.js";import{U as q}from"./index-5266a108.js";import"./Table-9e7095d0.js";import{o as b}from"./option-e755a7ae.js";import{R as f}from"./Row-a90e51f1.js";import{C as d}from"./Col-6e802f16.js";import{C as O}from"./Card-4e1bc556.js";import{F as i}from"./Form-57b1e97c.js";import{I as G}from"./Image-4e39bf60.js";import{B as g}from"./Button-cbb264fd.js";import"./Anchor-ceb627db.js";import"./Button-825b6efb.js";import"./index-8b12ee39.js";import"./createWithBsPrefix-d4ec82c8.js";import"./divWithClassName-189ef379.js";const T=()=>{const[v,E]=c.useState(!1),[j,w]=c.useState(""),[n,m]=c.useState([{value:"",image:"",previewImage:""}]),[u,h]=c.useState([]),[y,x]=c.useState(!1),[C,N]=c.useState(""),F="https://social-api.apikart.co/v1/",{id:V}=S(),k=L();c.useEffect(()=>{(async()=>{if(V)try{const o=await b.getVariationDetails(V);if((o==null?void 0:o.code)===200){const{name:r,variationValues:s,id:e}=o.data;N(e),w(r);const l=s.map(p=>({...p,image:`${p.image}`,previewImage:`${F}media/preview?filename=${p.image}`}));m(l)}}catch(o){console.error("Error fetching category:",o)}})()},[V]);const A=(t,o)=>{const r=[...n];r[t].image=o;const s=new FileReader;s.onload=e=>{var l;r[t].previewImage=(l=e==null?void 0:e.target)==null?void 0:l.result,m(r)},s.readAsDataURL(o)},D=(t,o)=>{const r=[...n],s=[...u];r[t].value=o,s[t]="",m(r),h(s)},P=()=>{m([...n,{value:"",image:"",previewImage:""}]),h([...u,""])},R=t=>{const o=[...n],r=[...u];o.splice(t,1),r.splice(t,1),m(o),h(r)},B=async t=>{if(t.currentTarget.checkValidity()===!1)t.preventDefault(),t.stopPropagation();else{t.preventDefault(),console.log("Form submitted:",n,j),x(!0);try{const s=new FormData;s.append("name",j),n.forEach((l,p)=>{s.append(`variationValues[${p}][value]`,l.value),l.image&&s.append(`variationValues[${p}][image]`,l.image)});const e=C?await b.updateVariation(s,C):await b.addVariation(s);console.log("res",e==null?void 0:e.code),(e==null?void 0:e.code)===200?(x(!1),I.success(e==null?void 0:e.message),k("/products/options")):((e==null?void 0:e.code)===400||(e==null?void 0:e.code)===401)&&I.error(e==null?void 0:e.message)}finally{x(!1)}}E(!0);const r=[];n.forEach((s,e)=>{s.value.trim()||(r[e]="Please fill the option value.")}),h(r)};return a.jsx(O,{children:a.jsx(O.Body,{children:a.jsxs(i,{noValidate:!0,validated:v,onSubmit:B,children:[a.jsx(f,{children:a.jsx(d,{lg:12,children:a.jsxs(i.Group,{className:"mb-3",children:[a.jsx(i.Label,{children:"Option Name"}),a.jsx(i.Control,{type:"text",id:"validationCustom01",placeholder:"Option name",value:j,onChange:t=>w(t.target.value),required:!0}),a.jsx(i.Control.Feedback,{type:"invalid",children:"Please fill the option name."})]})})}),a.jsx(f,{children:a.jsx(d,{lg:12,children:a.jsxs(i.Group,{className:"mb-3",children:[a.jsx(i.Label,{children:"Option Values"}),n.map((t,o)=>a.jsxs(f,{children:[a.jsxs(d,{className:"mb-2",children:[a.jsx(i.Control,{type:"text",placeholder:"Option value",value:t.value,onChange:r=>D(o,r.target.value),isInvalid:!!u[o],required:!0}),a.jsx(i.Control.Feedback,{type:"invalid",children:u[o]})]}),a.jsx(d,{className:"mb-2",children:a.jsx(i.Control,{type:"file",accept:"image/*",onChange:r=>{var s;return A(o,(s=r==null?void 0:r.target)==null?void 0:s.files[0])}})}),(t==null?void 0:t.previewImage)&&a.jsx(d,{xs:"auto",children:a.jsx(q,{children:a.jsx(G,{style:{borderStyle:"solid",borderColor:"gray",width:"30px",height:"30px"},src:t==null?void 0:t.previewImage,alt:"preview",className:"avatar-lg rounded",fluid:!0})})}),a.jsxs(d,{xs:"auto",children:[o===n.length-1&&a.jsx(g,{variant:"success me-1",onClick:P,children:"+"}),o>0&&a.jsx(g,{variant:"danger",onClick:()=>R(o),children:"-"})]})]},o))]})})}),y?a.jsxs(g,{variant:"primary",disabled:!0,children:[a.jsx(U,{className:"spinner-border-sm",tag:"span",color:"white"})," ","Loading..."]}):a.jsx(g,{variant:"primary",type:"submit",disabled:y,children:"Submit"})]})})})},ia=()=>{const{id:v}=S();return a.jsxs(a.Fragment,{children:[a.jsx($,{title:v?"Edit Option":"Add Option",subName:"Option"}),a.jsx(f,{children:a.jsx(d,{lg:12,children:a.jsx(T,{})})})]})};export{ia as default};
